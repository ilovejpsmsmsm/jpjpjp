<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Hearts Mystery</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background: linear-gradient(135deg, #2d1b69 0%, #11001c 50%, #0d0221 100%);
            color: #ff69b4;
            min-height: 100vh;
            overflow-x: hidden;
            image-rendering: pixelated;
            font-size: 12px;
            line-height: 1.6;
            position: relative;
        }
        
        /* Animated Background Hearts */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .floating-heart {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ff1493;
            opacity: 0.8;
            will-change: transform, opacity;
            pointer-events: none;
            z-index: -2;
            box-shadow:
                /* Mini pixel heart shape */
                3px 0 0 #ff1493, 6px 0 0 #ff1493, 12px 0 0 #ff1493, 15px 0 0 #ff1493,
                -3px 3px 0 #ff1493, 0 3px 0 #ff1493, 3px 3px 0 #ff1493, 6px 3px 0 #ff1493, 9px 3px 0 #ff1493, 12px 3px 0 #ff1493, 15px 3px 0 #ff1493, 18px 3px 0 #ff1493,
                -3px 6px 0 #ff1493, 0 6px 0 #ff1493, 3px 6px 0 #ff1493, 6px 6px 0 #ff1493, 9px 6px 0 #ff1493, 12px 6px 0 #ff1493, 15px 6px 0 #ff1493, 18px 6px 0 #ff1493,
                0 9px 0 #ff1493, 3px 9px 0 #ff1493, 6px 9px 0 #ff1493, 9px 9px 0 #ff1493, 12px 9px 0 #ff1493, 15px 9px 0 #ff1493,
                3px 12px 0 #ff1493, 6px 12px 0 #ff1493, 9px 12px 0 #ff1493, 12px 12px 0 #ff1493,
                6px 15px 0 #ff1493, 9px 15px 0 #ff1493;
        }
        
        .floating-heart:nth-child(2n) {
            background: #ff69b4;
            opacity: 0.6;
            box-shadow:
                3px 0 0 #ff69b4, 6px 0 0 #ff69b4, 12px 0 0 #ff69b4, 15px 0 0 #ff69b4,
                -3px 3px 0 #ff69b4, 0 3px 0 #ff69b4, 3px 3px 0 #ff69b4, 6px 3px 0 #ff69b4, 9px 3px 0 #ff69b4, 12px 3px 0 #ff69b4, 15px 3px 0 #ff69b4, 18px 3px 0 #ff69b4,
                -3px 6px 0 #ff69b4, 0 6px 0 #ff69b4, 3px 6px 0 #ff69b4, 6px 6px 0 #ff69b4, 9px 6px 0 #ff69b4, 12px 6px 0 #ff69b4, 15px 6px 0 #ff69b4, 18px 6px 0 #ff69b4,
                0 9px 0 #ff69b4, 3px 9px 0 #ff69b4, 6px 9px 0 #ff69b4, 9px 9px 0 #ff69b4, 12px 9px 0 #ff69b4, 15px 9px 0 #ff69b4,
                3px 12px 0 #ff69b4, 6px 12px 0 #ff69b4, 9px 12px 0 #ff69b4, 12px 12px 0 #ff69b4,
                6px 15px 0 #ff69b4, 9px 15px 0 #ff69b4;
        }
        
        .floating-heart:nth-child(3n) {
            background: #ffb6c1;
            opacity: 0.5;
            box-shadow:
                3px 0 0 #ffb6c1, 6px 0 0 #ffb6c1, 12px 0 0 #ffb6c1, 15px 0 0 #ffb6c1,
                -3px 3px 0 #ffb6c1, 0 3px 0 #ffb6c1, 3px 3px 0 #ffb6c1, 6px 3px 0 #ffb6c1, 9px 3px 0 #ffb6c1, 12px 3px 0 #ffb6c1, 15px 3px 0 #ffb6c1, 18px 3px 0 #ffb6c1,
                -3px 6px 0 #ffb6c1, 0 3px 0 #ffb6c1, 3px 6px 0 #ffb6c1, 6px 6px 0 #ffb6c1, 9px 6px 0 #ffb6c1, 12px 6px 0 #ffb6c1, 15px 6px 0 #ffb6c1, 18px 6px 0 #ffb6c1,
                0 9px 0 #ffb6c1, 3px 9px 0 #ffb6c1, 6px 9px 0 #ffb6c1, 9px 9px 0 #ffb6c1, 12px 9px 0 #ffb6c1, 15px 9px 0 #ffb6c1,
                3px 12px 0 #ffb6c1, 6px 12px 0 #ffb6c1, 9px 12px 0 #ffb6c1, 12px 12px 0 #ffb6c1,
                6px 15px 0 #ffb6c1, 9px 15px 0 #ffb6c1;
        }
        
        @keyframes floatUp1 {
            0% {
                transform: translateY(calc(100vh + 50px)) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 0.8;
            }
            25% {
                transform: translateY(75vh) translateX(30px) rotate(45deg);
            }
            50% {
                transform: translateY(50vh) translateX(-20px) rotate(90deg);
            }
            75% {
                transform: translateY(25vh) translateX(40px) rotate(135deg);
            }
            95% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-50px) translateX(-10px) rotate(180deg);
                opacity: 0;
            }
        }
        
        @keyframes floatUp2 {
            0% {
                transform: translateY(calc(100vh + 50px)) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            8% {
                opacity: 0.6;
            }
            20% {
                transform: translateY(80vh) translateX(-25px) rotate(60deg);
            }
            40% {
                transform: translateY(60vh) translateX(35px) rotate(120deg);
            }
            60% {
                transform: translateY(40vh) translateX(-30px) rotate(180deg);
            }
            80% {
                transform: translateY(20vh) translateX(25px) rotate(240deg);
            }
            92% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-50px) translateX(-15px) rotate(270deg);
                opacity: 0;
            }
        }
        
        @keyframes floatUp3 {
            0% {
                transform: translateY(calc(100vh + 50px)) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            30% {
                transform: translateY(70vh) translateX(-40px) rotate(90deg);
            }
            45% {
                transform: translateY(55vh) translateX(20px) rotate(135deg);
            }
            65% {
                transform: translateY(35vh) translateX(-25px) rotate(225deg);
            }
            85% {
                transform: translateY(15vh) translateX(35px) rotate(315deg);
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-50px) translateX(10px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            position: relative;
        }
        
        .page.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Pixel Art Elements */
        .pixel-heart {
            width: 6px;
            height: 6px;
            margin: 1rem auto 2rem auto;
            position: relative;
            background: #ff1493;
            animation: heartbeat 2s infinite;
            box-shadow:
                /* Row 1 - Two bumps at top */
                6px 0 0 #ff1493, 12px 0 0 #ff1493, 24px 0 0 #ff1493, 30px 0 0 #ff1493, 36px 0 0 #ff1493,
                /* Row 2 - Full width */
                -6px 6px 0 #ff1493, 0 6px 0 #ff1493, 6px 6px 0 #ff1493, 12px 6px 0 #ff1493, 18px 6px 0 #ff1493, 24px 6px 0 #ff1493, 30px 6px 0 #ff1493, 36px 6px 0 #ff1493, 42px 6px 0 #ff1493,
                /* Row 3 - Full width */
                -6px 12px 0 #ff1493, 0 12px 0 #ff1493, 6px 12px 0 #ff1493, 12px 12px 0 #ff1493, 18px 12px 0 #ff1493, 24px 12px 0 #ff1493, 30px 12px 0 #ff1493, 36px 12px 0 #ff1493, 42px 12px 0 #ff1493,
                /* Row 4 - Narrowing */
                0 18px 0 #ff1493, 6px 18px 0 #ff1493, 12px 18px 0 #ff1493, 18px 18px 0 #ff1493, 24px 18px 0 #ff1493, 30px 18px 0 #ff1493, 36px 18px 0 #ff1493,
                /* Row 5 - More narrow */
                6px 24px 0 #ff1493, 12px 24px 0 #ff1493, 18px 24px 0 #ff1493, 24px 24px 0 #ff1493, 30px 24px 0 #ff1493,
                /* Row 6 - Even narrower */
                12px 30px 0 #ff1493, 18px 30px 0 #ff1493, 24px 30px 0 #ff1493,
                /* Row 7 - Point */
                18px 36px 0 #ff1493;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .pixel-skull {
            width: 60px;
            height: 60px;
            background: 
                linear-gradient(to right, transparent 20%, #ff69b4 20%, #ff69b4 80%, transparent 80%),
                linear-gradient(to bottom, transparent 30%, #ff69b4 30%, #ff69b4 70%, transparent 70%);
            position: relative;
            margin: 1rem auto;
        }
        
        .pixel-skull::before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #2d1b69;
            top: 20px;
            left: 16px;
            box-shadow: 16px 0 #2d1b69, 8px 16px #2d1b69;
        }
        
        /* Splash Page Styles */
        .splash-container {
            text-align: center;
            max-width: 600px;
            position: relative;
            border: 4px solid #ff69b4;
            padding: 2rem;
            background: rgba(255, 105, 180, 0.1);
        }
        
        .main-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-shadow: 4px 4px 0px #ff1493;
            color: #ffb6c1;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 4px 4px 0px #ff1493, 0 0 10px #ff69b4; }
            to { text-shadow: 4px 4px 0px #ff1493, 0 0 20px #ff69b4, 0 0 30px #ff1493; }
        }
        
        .subtitle {
            font-size: 0.8rem;
            margin-bottom: 2rem;
            color: #ffb6c1;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff1493, #ff69b4);
            border: 3px solid #ffb6c1;
            padding: 1rem 2rem;
            font-size: 0.8rem;
            font-family: 'Press Start 2P', monospace;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            position: relative;
        }
        
        .btn:hover {
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px #ff1493;
        }
        
        .btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0px #ff1493;
        }
        
        /* Story Page Styles */
        .story-container {
            max-width: 800px;
            text-align: left;
            border: 4px solid #ff69b4;
            padding: 2rem;
            background: rgba(255, 105, 180, 0.05);
        }
        
        .chapter-title {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #ffb6c1;
            text-shadow: 2px 2px 0px #ff1493;
        }
        
        .story-text {
            font-size: 0.7rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            text-align: left;
            color: #ff69b4;
        }
        
        .clue {
            color: #ffb6c1;
            background: rgba(255, 20, 147, 0.2);
            padding: 2px 4px;
            border: 1px solid #ff1493;
        }
        
        .story-nav {
            text-align: center;
            margin-top: 2rem;
        }
        
        /* Puzzles Landing Page */
        .puzzles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            max-width: 800px;
            margin: 2rem 0;
        }
        
        .puzzle-btn {
            background: linear-gradient(45deg, #2d1b69, #11001c);
            border: 3px solid #ff69b4;
            padding: 1.5rem 1rem;
            color: #ff69b4;
            font-size: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }
        
        .puzzle-btn:hover:not(.locked) {
            background: linear-gradient(45deg, #ff1493, #ff69b4);
            color: white;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px #ff1493;
        }
        
        .puzzle-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #666;
        }
        
        .puzzle-btn.completed {
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            border-color: #ffb6c1;
            color: white;
        }
        
        .puzzle-btn.completed::after {
            content: '♥';
            position: absolute;
            top: 5px;
            right: 5px;
            color: #ff1493;
        }
        
        /* Individual Puzzle Styles */
        .puzzle-container {
            max-width: 600px;
            text-align: center;
            border: 4px solid #ff69b4;
            padding: 2rem;
            background: rgba(255, 105, 180, 0.05);
        }
        
        /* Puzzle-specific visual elements */
        .number-display {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            color: #ff1493;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem;
            border: 2px solid #ff69b4;
            margin: 1rem 0;
            text-shadow: 0 0 10px #ff69b4;
            letter-spacing: 0.2em;
        }
        
        .caesar-scroll {
            background: linear-gradient(45deg, #8B4513, #D2691E);
            border: 3px solid #654321;
            padding: 1.5rem;
            margin: 1rem 0;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        
        .caesar-scroll::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #654321, #8B4513);
            z-index: -1;
            border-radius: 5px;
        }
        
        .caesar-text {
            font-family: 'Times New Roman', serif;
            font-size: 1.5rem;
            color: #2F1B14;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.3);
            letter-spacing: 0.1em;
        }
        
        .morse-display {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            padding: 1.5rem;
            border: 3px solid #00ff00;
            margin: 1rem 0;
            text-shadow: 0 0 10px #00ff00;
            letter-spacing: 0.3em;
            animation: morseFlicker 2s infinite;
        }
        
        @keyframes morseFlicker {
            0%, 90% { opacity: 1; }
            95% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .binary-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
            padding: 1rem;
            background: #001100;
            border: 3px solid #00ff00;
        }
        
        .binary-bit {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #003300;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            border: 1px solid #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }
        
        .interactive-bit {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interactive-bit:hover {
            background: #004400;
            transform: scale(1.1);
            box-shadow: 0 0 15px #00ff00;
        }
        
        .interactive-mirror {
            position: relative;
        }
        
        .interactive-mirror:hover {
            transform: scaleX(-1) scale(1.05);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }
        
        .mirror-text {
            font-size: 2rem;
            color: #ff69b4;
            background: linear-gradient(135deg, #C0C0C0, #E6E6FA);
            padding: 1.5rem;
            border: 4px solid #B0B0B0;
            margin: 1rem 0;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transform: scaleX(-1);
            letter-spacing: 0.2em;
        }
        
        .mirror-text::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 48%, rgba(255,255,255,0.3) 49%, rgba(255,255,255,0.3) 51%, transparent 52%);
            pointer-events: none;
        }
        
        .calendar {
            background: #fff;
            color: #000;
            border: 3px solid #ff1493;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Arial', sans-serif;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .calendar-header {
            background: #ff1493;
            color: white;
            padding: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .calendar-date {
            font-size: 3rem;
            font-weight: bold;
            color: #ff1493;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .atbash-stone {
            background: linear-gradient(135deg, #8B7355, #D2B48C);
            border: 4px solid #654321;
            padding: 1.5rem;
            margin: 1rem 0;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.4);
        }
        
        .atbash-stone::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px solid #A0522D;
            background: radial-gradient(circle, transparent 30%, rgba(139,115,85,0.2) 70%);
        }
        
        .atbash-text {
            font-family: 'Times New Roman', serif;
            font-size: 2rem;
            color: #2F1B14;
            text-shadow: 1px 1px 2px rgba(210,180,140,0.8);
            letter-spacing: 0.3em;
        }
        
        .phone-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 200px;
            margin: 1rem auto;
            background: #333;
            padding: 1rem;
            border: 3px solid #666;
            border-radius: 10px;
        }
        
        .phone-key {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #555, #777);
            border: 2px solid #999;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Arial', sans-serif;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .phone-key.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-color: #ffb6c1;
            transform: scale(1.1);
            box-shadow: 0 0 15px #ff69b4;
        }
        
        .key-number {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .key-letters {
            font-size: 0.6rem;
            margin-top: -2px;
        }
        
        .blood-drops {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            padding: 2rem;
            background: radial-gradient(circle, rgba(139, 0, 0, 0.3), transparent);
        }
        
        .blood-drop {
            width: 30px;
            height: 40px;
            background: linear-gradient(135deg, #8B0000, #FF0000);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
            animation: bloodDrip 3s infinite;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }
        
        .blood-drop::before {
            content: '♥';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }
        
        @keyframes bloodDrip {
            0%, 90% { transform: translateY(0); }
            95% { transform: translateY(5px); }
            100% { transform: translateY(0); }
        }
        
        .rot13-diary {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            border: 4px solid #654321;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .rot13-diary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            width: 3px;
            height: 100%;
            background: repeating-linear-gradient(
                to bottom,
                #ff1493 0px,
                #ff1493 2px,
                transparent 2px,
                transparent 20px
            );
        }
        
        .diary-text {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: #2F1B14;
            text-shadow: 1px 1px 2px rgba(210,180,140,0.8);
            margin-left: 40px;
            letter-spacing: 0.2em;
        }
        
        .reverse-alphabet {
            background: linear-gradient(135deg, #4B0082, #8A2BE2);
            color: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 3px solid #9370DB;
            position: relative;
            overflow: hidden;
        }
        
        .reverse-alphabet::before {
            content: 'Z Y X W V U T S R Q P O N M L K J I H G F E D C B A';
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            font-size: 0.8rem;
            opacity: 0.3;
            letter-spacing: 0.5em;
            text-align: center;
        }
        
        .reverse-text {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-top: 1rem;
        }
        
        .polybius-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            max-width: 300px;
            margin: 1rem auto;
            background: #2F1B14;
            padding: 1rem;
            border: 3px solid #8B4513;
        }
        
        .polybius-cell {
            width: 40px;
            height: 40px;
            background: #D2691E;
            border: 1px solid #654321;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            color: #2F1B14;
        }
        
        .polybius-cell.header {
            background: #8B4513;
            color: #D2691E;
        }
        
        .polybius-cell.highlight {
            background: #ff69b4;
            color: white;
            animation: polybiusPulse 1s infinite;
        }
        
        @keyframes polybiusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .puzzle-title {
            font-size: 1rem;
            margin-bottom: 1.5rem;
            color: #ffb6c1;
            text-shadow: 2px 2px 0px #ff1493;
        }
        
        .puzzle-instructions {
            font-size: 0.6rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            background: rgba(255, 20, 147, 0.1);
            padding: 1rem;
            border: 2px solid #ff1493;
            color: #ff69b4;
        }
        
        .puzzle-input {
            width: 100%;
            max-width: 300px;
            padding: 1rem;
            font-size: 0.8rem;
            font-family: 'Press Start 2P', monospace;
            border: 3px solid #ff69b4;
            background: rgba(255, 105, 180, 0.1);
            color: #ff69b4;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .puzzle-input::placeholder {
            color: rgba(255, 105, 180, 0.6);
        }
        
        .success-message {
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            color: white;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #ffb6c1;
        }
        
        .error-message {
            background: linear-gradient(45deg, #ff1493, #ff69b4);
            color: white;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #ff1493;
        }
        
        .puzzle-piece {
            display: inline-block;
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 1rem;
            margin: 0.5rem;
            border: 3px solid #ff1493;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            text-shadow: 2px 2px 0px #ff1493;
        }
        
        .puzzle-piece:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px #ff1493;
        }
        
        .puzzle-piece.dragging {
            opacity: 0.7;
            transform: rotate(5deg);
            cursor: grabbing;
        }
        
        .letter-slots {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(255, 105, 180, 0.1);
            border: 3px dashed #ff69b4;
            max-width: 800px;
            flex-wrap: wrap;
        }
        
        .word-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .letter-slot {
            width: 50px;
            height: 50px;
            border: 3px solid #ff69b4;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 105, 180, 0.05);
            font-size: 1.1rem;
            font-weight: bold;
            color: #ff69b4;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }
        
        .letter-slot.filled {
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            border-color: #ffb6c1;
            color: white;
            text-shadow: 2px 2px 0px #ff1493;
        }
        
        .letter-slot.drag-over {
            background: rgba(255, 20, 147, 0.3);
            border-color: #ffb6c1;
            transform: scale(1.1);
        }
        

        
        /* Final Pages */
        .final-container {
            max-width: 700px;
            text-align: center;
            border: 4px solid #ff69b4;
            padding: 2rem;
            background: rgba(255, 105, 180, 0.05);
        }
        
        .puzzle-pieces-display {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem auto;
            padding: 1.5rem;
            background: rgba(255, 20, 147, 0.1);
            border: 2px solid #ff1493;
            border-radius: 10px;
            max-width: 600px;
            min-height: 120px;
            align-items: center;
        }
        
        .final-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff1493 0%, #ff69b4 50%, #ffb6c1 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .final-modal.show {
            display: flex;
        }
        
        .final-message {
            background: rgba(255, 255, 255, 0.95);
            color: #2d1b69;
            padding: 3rem;
            border: 4px solid #ff1493;
            text-align: center;
            max-width: 600px;
            box-shadow: 8px 8px 0px #ff1493;
        }
        
        .final-message h1 {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: #ff1493;
            text-shadow: 2px 2px 0px #ffb6c1;
        }
        
        .final-message p {
            font-size: 0.7rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: #2d1b69;
        }
        
        .back-btn {
            background: linear-gradient(45deg, #ff69b4, #ffb6c1);
            border: 3px solid #ff1493;
            padding: 0.8rem 1.5rem;
            font-size: 0.6rem;
            font-family: 'Press Start 2P', monospace;
            color: white;
            cursor: pointer;
            margin: 1rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px #ff1493;
        }
        
        /* Scary Elements */
        .glitch {
            animation: glitch 0.3s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        .blood-drip {
            position: relative;
        }
        
        .blood-drip::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            width: 4px;
            height: 20px;
            background: linear-gradient(to bottom, #ff1493, transparent);
            animation: drip 3s infinite;
        }
        
        @keyframes drip {
            0%, 90% { height: 0; }
            100% { height: 20px; }
        }
        
        .timer-warning {
            animation: timerPulse 1s infinite;
            color: #ff1493 !important;
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .letter-collected-animation {
            animation: letterCollected 0.8s ease-out;
        }
        
        @keyframes letterCollected {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #ffb6c1; }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            .main-title {
                font-size: 1.2rem;
            }
            
            .puzzles-grid {
                grid-template-columns: 1fr;
            }
            
            .final-message {
                margin: 1rem;
                padding: 2rem;
            }
            
            .story-container, .puzzle-container, .final-container {
                padding: 1rem;
            }
            
            .letter-slots {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .word-group {
                justify-content: center;
            }
            
            .word-spacer {
                width: 50px;
                height: 2px;
                margin: 0;
            }
            
            .puzzle-pieces-display {
                max-width: 100%;
                padding: 1rem;
            }
            
            .letter-slot {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background Hearts -->
    <div class="floating-hearts" id="floating-hearts"></div>
    <!-- Splash Page -->
    <div class="page active" id="splash">
        <div class="splash-container">
            <h1 class="main-title">PIXEL HEARTS MYSTERY</h1>
            <p class="subtitle">A LOVE LETTER WRITTEN IN BLOOD...</p>
            <div class="pixel-skull"></div>
            <button class="btn" onclick="showPage('story')">START GAME</button>
        </div>
    </div>

    <!-- Story Page -->
    <div class="page" id="story">
        <div class="story-container">
            <div id="chapter1" class="chapter active-chapter">
                <h2 class="chapter-title blood-drip">CHAPTER 1: THE PINK PRISON</h2>
                <div class="story-text">
                    You wake up in a strange pink room with no memory of how you got here. The walls pulse with a sickly sweet glow, covered in pixel art hearts that seem to watch you. On the wall, written in what looks like dried blood, you see the message: <span class="clue">"I LOVE YOU BABY"</span>. But each letter flickers and fades, as if the message is incomplete.
                    <br><br>
                    A computer terminal in the corner crackles to life. The screen shows: <span class="clue">"Welcome to my world... I've been so lonely. My name was Yisha, and I died for love. Help me complete my final message, or join me in eternal solitude."</span>
                    <br><br>
                    The air grows cold as you realize the truth - you're trapped in a digital purgatory created by a lovesick ghost. The only way out is to solve her cryptic puzzles and piece together her tragic love story.
                </div>
            </div>
            
            <div id="chapter2" class="chapter">
                <h2 class="chapter-title glitch">CHAPTER 2: YISHA'S OBSESSION</h2>
                <div class="story-text">
                    The computer screen flickers with pink static. A ghostly figure materializes - a pixelated girl with hollow, glowing eyes. Her voice echoes through the room like a broken record:
                    <br><br>
                    <span class="clue">"I was a programmer, you know. I created this place as a love letter to someone who never loved me back. Every cipher, every code, every puzzle - they're pieces of my broken heart."</span>
                    <br><br>
                    The walls begin to shift and change, revealing hidden doors marked with cryptic symbols. Caesar ciphers, morse code, binary patterns - all the languages of her digital despair.
                    <br><br>
                    <span class="clue">"I encoded my feelings in every system I knew. When he rejected me on September 8th, I couldn't bear it. I poured my soul into this code... and now I'm trapped here forever."</span>
                </div>
            </div>
            
            <div id="chapter3" class="chapter">
                <h2 class="chapter-title">CHAPTER 3: THE CIPHER OF HEARTBREAK</h2>
                <div class="story-text">
                    As you solve each puzzle, Yisha's form becomes more solid, more human. Her pixel edges soften, revealing the girl she once was - brilliant, passionate, and desperately lonely.
                    <br><br>
                    <span class="clue">"Each cipher you decode brings back a memory. The Caesar cipher from our first encrypted message... the morse code I tapped on his window... the binary tears I cried when he said no."</span>
                    <br><br>
                    The room fills with floating equations and code fragments - the mathematical poetry of her unrequited love. Phone keypads spell out unsent messages, mirror writing reveals hidden truths.
                    <br><br>
                    <span class="clue">"I thought if I could just encode my love perfectly, make it beautiful enough, complex enough... maybe he'd understand. But love isn't a puzzle to be solved, is it?"</span>
                </div>
            </div>
            
            <div id="chapter4" class="chapter">
                <h2 class="chapter-title blood-drip">CHAPTER 4: THE FINAL DECODE</h2>
                <div class="story-text">
                    With most puzzles solved, the horrifying truth emerges. Yisha didn't just die of heartbreak - she took her own life, leaving behind this digital monument to obsessive love.
                    <br><br>
                    <span class="clue">"I thought death would end the pain, but I only trapped myself deeper in the code. Every visitor who enters my pink prison becomes part of my eternal loop of longing."</span>
                    <br><br>
                    The room glitches violently. Pink pixels rain down like digital blood. Yisha's form flickers between the girl she was and the ghost she became.
                    <br><br>
                    <span class="clue">"You're different though. You're solving my puzzles not out of obsession, but out of compassion. Maybe... maybe you can help me learn that love should be freely given, not desperately encoded."</span>
                    <br><br>
                    The clock shows 11:47 PM. In 13 minutes, you'll be trapped forever in her world of cryptic love.
                </div>
            </div>
            
            <div class="story-nav">
                <button class="btn" id="prevChapter" onclick="prevChapter()" style="display: none;">PREVIOUS</button>
                <button class="btn" id="nextChapter" onclick="nextChapter()">NEXT</button>
                <button class="btn" id="toPuzzles" onclick="showPage('puzzles')" style="display: none;">SOLVE PUZZLES</button>
            </div>
        </div>
    </div>

    <!-- Puzzles Landing Page -->
    <div class="page" id="puzzles">
        <div class="final-container">
            <h1 class="chapter-title glitch">THE HEART PUZZLES</h1>
            <p class="story-text" style="text-align: center; font-size: 0.6rem;">SOLVE EACH PUZZLE TO COLLECT THE LETTERS OF LOVE</p>
            <div style="text-align: center; margin: 1rem 0; font-size: 0.5rem; color: #ffb6c1;">
                TIME REMAINING: <span id="countdown-timer">02:00:00</span><br>
                LETTERS COLLECTED: <span id="letter-counter" style="transition: all 0.5s ease; display: inline-block;">0/12</span>
            </div>
            
            <div class="puzzles-grid">
                <button class="puzzle-btn" id="puzzle1-btn" onclick="showPuzzle(1)">
                    <h3>PUZZLE 1</h3>
                    <p>THE GHOST'S FATE</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle2-btn" onclick="showPuzzle(2)">
                    <h3>PUZZLE 2</h3>
                    <p>CAESAR'S LOVE LETTER</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle3-btn" onclick="showPuzzle(3)">
                    <h3>PUZZLE 3</h3>
                    <p>MORSE CODE HEARTBEAT</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle4-btn" onclick="showPuzzle(4)">
                    <h3>PUZZLE 4</h3>
                    <p>BINARY TEARS</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle5-btn" onclick="showPuzzle(5)">
                    <h3>PUZZLE 5</h3>
                    <p>MIRROR WRITING</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle6-btn" onclick="showPuzzle(6)">
                    <h3>PUZZLE 6</h3>
                    <p>THE REJECTION DATE</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle7-btn" onclick="showPuzzle(7)">
                    <h3>PUZZLE 7</h3>
                    <p>ATBASH CIPHER</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle8-btn" onclick="showPuzzle(8)">
                    <h3>PUZZLE 8</h3>
                    <p>PHONE KEYPAD</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle9-btn" onclick="showPuzzle(9)">
                    <h3>PUZZLE 9</h3>
                    <p>BLOOD DROPS</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle10-btn" onclick="showPuzzle(10)">
                    <h3>PUZZLE 10</h3>
                    <p>ROT13 DIARY</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle11-btn" onclick="showPuzzle(11)">
                    <h3>PUZZLE 11</h3>
                    <p>REVERSE ALPHABET</p>
                </button>
                <button class="puzzle-btn locked" id="puzzle12-btn" onclick="showPuzzle(12)">
                    <h3>PUZZLE 12</h3>
                    <p>FINAL HEARTBREAK</p>
                </button>
            </div>
            
            <button class="back-btn" onclick="showPage('story')">BACK TO STORY</button>
        </div>
    </div>

    <!-- Puzzle 1: The Ghost's Name -->
    <div class="page" id="puzzle1">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 1: THE GHOST'S FATE</h1>
            <div class="puzzle-instructions">
                The computer screen flickers with a cryptic message:<br>
                <div class="number-display">4-5-1-20-8</div>
                <strong>THE TWIST:</strong> These numbers represent alphabet positions, but there's a hidden meaning! The ghost whispers: <em>"This isn't my name... it's what I became when love turned cold. Decode the numbers, then take the MIDDLE letter of what you spell."</em><br><br>
                                What's the MIDDLE letter of the decoded word? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle1-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle1()">
            <br>
            <button class="btn" onclick="checkPuzzle1()">SUBMIT</button>
            <div id="puzzle1-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 2: Caesar's Love Letter -->
    <div class="page" id="puzzle2">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 2: CAESAR'S LOVE LETTER</h1>
            <div class="puzzle-instructions">
                A torn love letter appears, written in Caesar cipher with a shift of 3:<br>
                <div class="caesar-scroll">
                    <div class="caesar-text">ORYH</div>
                </div>
                              What's the first letter of the decoded message? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle2-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle2()">
            <br>
            <button class="btn" onclick="checkPuzzle2()">SUBMIT</button>
            <div id="puzzle2-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 3: Morse Code Heartbeat -->
    <div class="page" id="puzzle3">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 3: MORSE CODE HEARTBEAT</h1>
            <div class="puzzle-instructions">
                The ghost's heartbeat echoes in morse code:<br>
                <div class="morse-display">--- / ...- / . / .-. / -.-- / --- / ..-</div>
                                What's the first letter of the decoded message? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle3-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle3()">
            <br>
            <button class="btn" onclick="checkPuzzle3()">SUBMIT</button>
            <div id="puzzle3-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 4: Interactive Binary Tears -->
    <div class="page" id="puzzle4">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 4: BINARY TEARS</h1>
            <div class="puzzle-instructions">
                The ghost's tears fall in a pattern. Click the tears to flip them between 0 and 1.<br>
                Make them spell out the letter that represents "TORMENT" in ASCII (84):<br>
                <div class="binary-grid" id="binary-grid">
                    <div class="binary-bit interactive-bit" data-value="1" onclick="flipBit(this)">1</div>
                    <div class="binary-bit interactive-bit" data-value="0" onclick="flipBit(this)">0</div>
                    <div class="binary-bit interactive-bit" data-value="1" onclick="flipBit(this)">1</div>
                    <div class="binary-bit interactive-bit" data-value="0" onclick="flipBit(this)">0</div>
                    <div class="binary-bit interactive-bit" data-value="1" onclick="flipBit(this)">1</div>
                    <div class="binary-bit interactive-bit" data-value="0" onclick="flipBit(this)">0</div>
                    <div class="binary-bit interactive-bit" data-value="1" onclick="flipBit(this)">1</div>
                    <div class="binary-bit interactive-bit" data-value="1" onclick="flipBit(this)">1</div>
                </div>
                <div style="margin: 1rem 0; font-size: 0.6rem; color: #ffb6c1;">
                    Current binary: <span id="current-binary">10101011</span> = ASCII <span id="current-ascii">171</span>
                </div>
                <strong>HINT:</strong> You need to make the binary equal 01010100 (which is 84 in decimal = letter T)<br>
                Click the tears to change them from 0 to 1 or 1 to 0!
            </div>
            <div id="puzzle4-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 5: Interactive Mirror Writing -->
    <div class="page" id="puzzle5">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 5: MIRROR WRITING</h1>
            <div class="puzzle-instructions">
                The ghost's message appears in a haunted mirror. Click the mirror to flip it and reveal the hidden message:<br>
                <div class="mirror-text interactive-mirror" id="mirror-text" onclick="flipMirror()" style="cursor: pointer; transition: all 0.5s ease;">
                    KCAB EMOC
                </div>
                <div style="margin: 1rem 0; font-size: 0.6rem; color: #ffb6c1;">
                    *Click the mirror to flip the reflection*<br>
                    Mirror is currently: <span id="mirror-state">REVERSED</span>
                </div>
                <strong>HINT:</strong> The ghost wrote this message in mirror writing. Flip the mirror to read it normally!<br>
                Once you can read the message clearly, what's the first letter? 
            </div>
            <div id="puzzle5-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 6: The Rejection Date -->
    <div class="page" id="puzzle6">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 6: THE REJECTION DATE</h1>
            <div class="puzzle-instructions">
                A calendar page shows the day she was rejected:<br>
                <div class="calendar">
                    <div class="calendar-header">SEPTEMBER 2024</div>
                    <div class="calendar-date">8</div>
                </div>
                             What letter corresponds to this date? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle6-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle6()">
            <br>
            <button class="btn" onclick="checkPuzzle6()">SUBMIT</button>
            <div id="puzzle6-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 7: Atbash Cipher -->
    <div class="page" id="puzzle7">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 7: ATBASH CIPHER</h1>
            <div class="puzzle-instructions">
                Ancient symbols spell out her deepest fear using the Atbash cipher:<br>
                <div class="atbash-stone">
                    <div class="atbash-text">ZMLOV</div>
                </div>
            
                What's the LAST letter of the decoded word?
            </div>
            <input type="text" class="puzzle-input" id="puzzle7-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle7()">
            <br>
            <button class="btn" onclick="checkPuzzle7()">SUBMIT</button>
            <div id="puzzle7-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 8: Phone Keypad -->
    <div class="page" id="puzzle8">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 8: PHONE KEYPAD</h1>
            <div class="puzzle-instructions">
                Her last text message, encoded in old phone keypad. She pressed: 44-33-555-7<br>
                <div class="phone-keypad">
                    <div class="phone-key"><div class="key-number">1</div></div>
                    <div class="phone-key"><div class="key-number">2</div><div class="key-letters">ABC</div></div>
                    <div class="phone-key"><div class="key-number">3</div><div class="key-letters">DEF</div></div>
                    <div class="phone-key"><div class="key-number">4</div><div class="key-letters">GHI</div></div>
                    <div class="phone-key"><div class="key-number">5</div><div class="key-letters">JKL</div></div>
                    <div class="phone-key"><div class="key-number">6</div><div class="key-letters">MNO</div></div>
                    <div class="phone-key"><div class="key-number">7</div><div class="key-letters">PQRS</div></div>
                    <div class="phone-key"><div class="key-number">8</div><div class="key-letters">TUV</div></div>
                    <div class="phone-key"><div class="key-number">9</div><div class="key-letters">WXYZ</div></div>
                </div>
                               What's the first letter of this decoded message? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle8-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle8()">
            <br>
            <button class="btn" onclick="checkPuzzle8()">SUBMIT</button>
            <div id="puzzle8-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 9: Blood Drops -->
    <div class="page" id="puzzle9">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 9: BLOOD DROPS</h1>
            <div class="puzzle-instructions">
                Blood drops form a pattern on the floor:<br>
                <div class="blood-drops">
                    <div class="blood-drop"></div>
                    <div class="blood-drop"></div>
                </div>
                                What letter do these drops represent? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle9-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle9()">
            <br>
            <button class="btn" onclick="checkPuzzle9()">SUBMIT</button>
            <div id="puzzle9-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 10: ROT13 Diary -->
    <div class="page" id="puzzle10">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 10: ROT13 DIARY</h1>
            <div class="puzzle-instructions">
                Her diary entry, encoded in ROT13 with a twist:<br>
                <div class="rot13-diary">
                    <div class="diary-text">QRNGU</div>
                </div>
              
                How many vowels are in the decoded word? What letter does that number represent? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle10-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle10()">
            <br>
            <button class="btn" onclick="checkPuzzle10()">SUBMIT</button>
            <div id="puzzle10-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 11: Reverse Alphabet -->
    <div class="page" id="puzzle11">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 11: REVERSE ALPHABET</h1>
            <div class="puzzle-instructions">
                Her world turned upside down. In reverse alphabet:<br>
                <div class="reverse-alphabet">
                    <div class="reverse-text">Position 25</div>
                </div>
                              What letter is at position 25 in the reverse alphabet? 
            </div>
            <input type="text" class="puzzle-input" id="puzzle11-input" placeholder="ENTER LETTER" maxlength="1" onkeypress="if(event.key==='Enter') checkPuzzle11()">
            <br>
            <button class="btn" onclick="checkPuzzle11()">SUBMIT</button>
            <div id="puzzle11-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Puzzle 12: Final Heartbreak -->
    <div class="page" id="puzzle12">
        <div class="puzzle-container">
            <h1 class="puzzle-title">PUZZLE 12: FINAL HEARTBREAK</h1>
            <div class="puzzle-instructions">
                Her final, desperate message echoes through the Polybius Square. The ghost's obsession reaches its peak:<br>
                <div class="number-display">55 35 51 / 11 42 15 / 33 24 34 15</div>
                <div class="polybius-grid">
                    <div class="polybius-cell header"></div>
                    <div class="polybius-cell header">1</div>
                    <div class="polybius-cell header">2</div>
                    <div class="polybius-cell header">3</div>
                    <div class="polybius-cell header">4</div>
                    <div class="polybius-cell header">5</div>
                    <div class="polybius-cell header">1</div>
                    <div class="polybius-cell">A</div>
                    <div class="polybius-cell">B</div>
                    <div class="polybius-cell">C</div>
                    <div class="polybius-cell">D</div>
                    <div class="polybius-cell">E</div>
                    <div class="polybius-cell header">2</div>
                    <div class="polybius-cell">F</div>
                    <div class="polybius-cell">G</div>
                    <div class="polybius-cell">H</div>
                    <div class="polybius-cell">I</div>
                    <div class="polybius-cell">J</div>
                    <div class="polybius-cell header">3</div>
                    <div class="polybius-cell">K</div>
                    <div class="polybius-cell">L</div>
                    <div class="polybius-cell">M</div>
                    <div class="polybius-cell">N</div>
                    <div class="polybius-cell">O</div>
                    <div class="polybius-cell header">4</div>
                    <div class="polybius-cell">P</div>
                    <div class="polybius-cell">Q</div>
                    <div class="polybius-cell">R</div>
                    <div class="polybius-cell">S</div>
                    <div class="polybius-cell">T</div>
                    <div class="polybius-cell header">5</div>
                    <div class="polybius-cell">U</div>
                    <div class="polybius-cell">V</div>
                    <div class="polybius-cell">W</div>
                    <div class="polybius-cell">X</div>
                    <div class="polybius-cell">Y</div>
                </div>
                <strong>DECODE THE COORDINATES:</strong> Each pair represents row-column positions in the grid.<br>
                                             Enter the complete decoded message: 
            </div>
            <input type="text" class="puzzle-input" id="puzzle12-input" placeholder="ENTER FULL MESSAGE" maxlength="20" onkeypress="if(event.key==='Enter') checkPuzzle12()" style="max-width: 400px;">
            <br>
            <button class="btn" onclick="checkPuzzle12()">SUBMIT</button>
            <div id="puzzle12-result"></div>
            <button class="back-btn" onclick="showPage('puzzles')">BACK</button>
        </div>
    </div>

    <!-- Final Unscramble Page -->
    <div class="page" id="final-unscramble">
        <div class="final-container">
            <h1 class="chapter-title glitch">COMPLETE THE MESSAGE</h1>
            <div class="pixel-heart"></div>
            <p class="story-text" style="text-align: center; font-size: 0.6rem;">DRAG THE LETTERS TO SPELL THE GHOST'S MESSAGE</p>
            
            <div class="letter-slots" id="letter-slots">
                <div class="word-group">
                    <div class="letter-slot" data-position="1" data-target="I"></div>
                </div>
                
                <div class="word-group">
                    <div class="letter-slot" data-position="2" data-target="L"></div>
                    <div class="letter-slot" data-position="3" data-target="O"></div>
                    <div class="letter-slot" data-position="4" data-target="V"></div>
                    <div class="letter-slot" data-position="5" data-target="E"></div>
                </div>
                
                <div class="word-group">
                    <div class="letter-slot" data-position="6" data-target="Y"></div>
                    <div class="letter-slot" data-position="7" data-target="O"></div>
                    <div class="letter-slot" data-position="8" data-target="U"></div>
                </div>
                
                <div class="word-group">
                    <div class="letter-slot" data-position="9" data-target="B"></div>
                    <div class="letter-slot" data-position="10" data-target="A"></div>
                    <div class="letter-slot" data-position="11" data-target="B"></div>
                    <div class="letter-slot" data-position="12" data-target="Y"></div>
                </div>
            </div>
            
            <div class="puzzle-instructions">
                DRAG YOUR COLLECTED HEART PIECES FROM BELOW
            </div>
            
            <div class="puzzle-pieces-display" id="collected-pieces">
                <!-- Puzzle pieces will be added here -->
            </div>
            
            <div id="final-result"></div>
      
        </div>
    </div>

   <!-- Final Message Modal -->
<div class="final-modal" id="final-modal">
    <div class="final-message" style="max-height: 80vh; overflow-y: auto;">
        <h1 style="margin-bottom: 1.5rem;">Hi baby, happy 5th monthsary ♡</h1>
        <p style="margin-bottom: 1.7em;">
            Sobrang bilis five months na agad. Minsan parang ang tagal na rin kasi ang dami na nating napagdaanan, but I wouldn’t have it any other way.<br>
            I’m really happy na ikaw yung kasama ko through everything. Iba yung peace and comfort na binibigay mo sakin every single day.
        </p>
        <hr style="margin: 2em 0; border: none; border-top: 2px dashed #ffb6c1;">
        <p style="margin-bottom: 1.7em;">
            Sobrang proud ako sayo, baby. Sa growth mo, sa efforts mo, sa lahat ng ginagawa mo. I see it all,<br>
            and I’ll always be here to remind you na kaya mo lahat. I believe in you, and I’ll keep praying for all your dreams, your plans, and everything you're working hard for—alam kong mangyayari lahat ng ‘yan.
        </p>
        <hr style="margin: 2em 0; border: none; border-top: 2px dashed #ffb6c1;">
        <p style="margin-bottom: 1.7em;">
            Thank you for everything baby for being the best boyfriend I could ever ask for. For your patience, your understanding, sa lahat lahat.<br>
            For always making time for me, for listening to my kwentos even if they don’t always make sense, and for making me feel okay palagi.
        </p>
        <hr style="margin: 2em 0; border: none; border-top: 2px dashed #ffb6c1;">
        <p style="margin-bottom: 1.7em;">
            You’re my answered prayer. And everyday, I thank God for giving me someone like you.<br>
            Someone who makes me feel safe, loved, and seen.
        </p>
        <p style="margin-bottom: 1.7em;">
            I’ll always support you sa lahat ng gusto mong gawin sa plans mo, goals mo, dreams mo.
        </p>
        <p style="margin-bottom: 2em;">
            <strong>I love you so much, my love.<br>
            Happy five months to us, baby!</strong>
        </p>
        <button class="btn" onclick="closeFinalModal()" style="margin-top: 1.5em;">RESTART GAME</button>
    </div>
</div>

    <script>
        let currentChapter = 1;
        let solvedPuzzles = [];
        let collectedLetters = [];
        let countdownTimer = null;
        let timeRemaining = 7200; // 2 hours in seconds
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Start timer when entering puzzles page
            if (pageId === 'puzzles' && !countdownTimer) {
                startCountdown();
            }
        }
        
        function startCountdown() {
            const timerElement = document.getElementById('countdown-timer');
            
            countdownTimer = setInterval(() => {
                timeRemaining--;
                
                const hours = Math.floor(timeRemaining / 3600);
                const minutes = Math.floor((timeRemaining % 3600) / 60);
                const seconds = timeRemaining % 60;
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerElement.textContent = timeString;
                
                // Add warning animation when less than 10 minutes
                if (timeRemaining <= 600) {
                    timerElement.classList.add('timer-warning');
                }
                
                // Game over when time runs out
                if (timeRemaining <= 0) {
                    clearInterval(countdownTimer);
                    timerElement.textContent = '00:00:00';
                    showGameOverModal();
                }
            }, 1000);
        }
        
        function showGameOverModal() {
            const modal = document.getElementById('final-modal');
            const message = modal.querySelector('.final-message');
            message.innerHTML = `
                <h1>TIME'S UP!</h1>
                <div class="pixel-heart"></div>
                <p>The ghost's curse has trapped you forever...</p>
                <p><strong>"You took too long... now you'll stay with me in this pink prison for eternity."</strong></p>
                <p>The room fills with pink static as you become part of the code.</p>
                <button class="btn" onclick="closeFinalModal()">TRY AGAIN</button>
            `;
            modal.classList.add('show');
        }
        
        function showPuzzle(puzzleNum) {
            if (puzzleNum === 1 || solvedPuzzles.includes(puzzleNum - 1)) {
                showPage('puzzle' + puzzleNum);
            }
        }
        
        function nextChapter() {
            if (currentChapter < 4) {
                document.getElementById('chapter' + currentChapter).style.display = 'none';
                currentChapter++;
                document.getElementById('chapter' + currentChapter).style.display = 'block';
                
                if (currentChapter > 1) {
                    document.getElementById('prevChapter').style.display = 'inline-block';
                }
            } else {
                document.getElementById('nextChapter').style.display = 'none';
                document.getElementById('toPuzzles').style.display = 'inline-block';
            }
        }
        
        function prevChapter() {
            if (currentChapter > 1) {
                document.getElementById('chapter' + currentChapter).style.display = 'none';
                currentChapter--;
                document.getElementById('chapter' + currentChapter).style.display = 'block';
                
                if (currentChapter === 1) {
                    document.getElementById('prevChapter').style.display = 'none';
                }
                
                if (currentChapter < 4) {
                    document.getElementById('nextChapter').style.display = 'inline-block';
                    document.getElementById('toPuzzles').style.display = 'none';
                }
            }
        }
        
        function unlockNextPuzzle(puzzleNum) {
            if (puzzleNum < 12) {
                const nextBtn = document.getElementById('puzzle' + (puzzleNum + 1) + '-btn');
                nextBtn.classList.remove('locked');
            }
            
            const currentBtn = document.getElementById('puzzle' + puzzleNum + '-btn');
            currentBtn.classList.add('completed');
            
            // Update letter counter with animation
            const counter = document.getElementById('letter-counter');
            if (counter) {
                counter.classList.add('letter-collected-animation');
                counter.textContent = solvedPuzzles.length + '/12';
                
                setTimeout(() => {
                    counter.classList.remove('letter-collected-animation');
                }, 800);
            }
            
            if (solvedPuzzles.length === 12) {
                showPage('final-unscramble');
                displayCollectedLetters();
            }
        }
        
        const targetLetters = ['I', 'L', 'O', 'V', 'E', 'Y', 'O', 'U', 'B', 'A', 'B', 'Y'];
        // Scrambled letters that players collect (not in order)
        const scrambledLetters = ['B', 'Y', 'I', 'O', 'V', 'A', 'L', 'U', 'E', 'B', 'O', 'Y'];
        
        function checkPuzzle1() {
            const answer = document.getElementById('puzzle1-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle1-result');
            
            if (answer === 'A') {
                result.innerHTML = '<div class="success-message">CORRECT! DEATH... the middle letter reveals her tragic fate! <span class="puzzle-piece">B</span></div>';
                if (!solvedPuzzles.includes(1)) {
                    solvedPuzzles.push(1);
                    collectedLetters.push('B');
                    unlockNextPuzzle(1);
                }
            } else if (answer === 'D') {
                result.innerHTML = '<div class="error-message">CLOSE! You found the first letter, but she wants the MIDDLE letter of the word!</div>';
            } else if (answer === 'H') {
                result.innerHTML = '<div class="error-message">CLOSE! You found the last letter, but she wants the MIDDLE letter of the word!</div>';
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle2() {
            const answer = document.getElementById('puzzle2-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle2-result');
            
            if (answer === 'L') {
                result.innerHTML = '<div class="success-message">CORRECT! "LOVE" - the first letter of her deepest feeling... <span class="puzzle-piece">Y</span></div>';
                if (!solvedPuzzles.includes(2)) {
                    solvedPuzzles.push(2);
                    collectedLetters.push('Y');
                    unlockNextPuzzle(2);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle3() {
            const answer = document.getElementById('puzzle3-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle3-result');
            
            if (answer === 'O') {
                result.innerHTML = '<div class="success-message">CORRECT! "OVER YOU" - her obsession revealed... <span class="puzzle-piece">I</span></div>';
                if (!solvedPuzzles.includes(3)) {
                    solvedPuzzles.push(3);
                    collectedLetters.push('I');
                    unlockNextPuzzle(3);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        let mirrorFlipped = false;
        
        function flipBit(element) {
            const currentValue = element.dataset.value;
            const newValue = currentValue === '1' ? '0' : '1';
            element.dataset.value = newValue;
            element.textContent = newValue;
            
            // Update display
            updateBinaryDisplay();
            checkBinaryPuzzle();
        }
        
        function updateBinaryDisplay() {
            const bits = document.querySelectorAll('.interactive-bit');
            let binaryString = '';
            bits.forEach(bit => {
                binaryString += bit.dataset.value;
            });
            
            const decimal = parseInt(binaryString, 2);
            document.getElementById('current-binary').textContent = binaryString;
            document.getElementById('current-ascii').textContent = decimal;
        }
        
        function checkBinaryPuzzle() {
            const bits = document.querySelectorAll('.interactive-bit');
            let binaryString = '';
            bits.forEach(bit => {
                binaryString += bit.dataset.value;
            });
            
            if (binaryString === '01010100') {
                const result = document.getElementById('puzzle4-result');
                result.innerHTML = '<div class="success-message">PERFECT! You\'ve arranged her tears to spell T (TORMENT)! <span class="puzzle-piece">O</span></div>';
                if (!solvedPuzzles.includes(4)) {
                    solvedPuzzles.push(4);
                    collectedLetters.push('O');
                    unlockNextPuzzle(4);
                }
            }
        }
        
        function flipMirror() {
            const mirror = document.getElementById('mirror-text');
            const state = document.getElementById('mirror-state');
            
            mirrorFlipped = !mirrorFlipped;
            
            if (mirrorFlipped) {
                mirror.style.transform = 'scaleX(1)';
                mirror.textContent = 'COME BACK';
                state.textContent = 'NORMAL';
                
                // Auto-solve when flipped correctly
                setTimeout(() => {
                    const result = document.getElementById('puzzle5-result');
                    result.innerHTML = '<div class="success-message">EXCELLENT! You flipped the mirror and revealed "COME BACK"! <span class="puzzle-piece">V</span></div>';
                    if (!solvedPuzzles.includes(5)) {
                        solvedPuzzles.push(5);
                        collectedLetters.push('V');
                        unlockNextPuzzle(5);
                    }
                }, 500);
            } else {
                mirror.style.transform = 'scaleX(-1)';
                mirror.textContent = 'KCAB EMOC';
                state.textContent = 'REVERSED';
            }
        }
        

        
        function checkPuzzle6() {
            const answer = document.getElementById('puzzle6-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle6-result');
            
            if (answer === 'H') {
                result.innerHTML = '<div class="success-message">CORRECT! September 8th... the day her heart broke... <span class="puzzle-piece">A</span></div>';
                if (!solvedPuzzles.includes(6)) {
                    solvedPuzzles.push(6);
                    collectedLetters.push('A');
                    unlockNextPuzzle(6);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle7() {
            const answer = document.getElementById('puzzle7-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle7-result');
            
            if (answer === 'E') {
                result.innerHTML = '<div class="success-message">CORRECT! "ALONE" - her greatest fear... the last letter is E! <span class="puzzle-piece">L</span></div>';
                if (!solvedPuzzles.includes(7)) {
                    solvedPuzzles.push(7);
                    collectedLetters.push('L');
                    unlockNextPuzzle(7);
                }
            } else if (answer === 'A' || answer === 'N' || answer === 'L' || answer === 'O') {
                result.innerHTML = '<div class="error-message">You decoded part of "ALONE" correctly! But I need the LAST letter of the word.</div>';
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle8() {
            const answer = document.getElementById('puzzle8-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle8-result');
            
            if (answer === 'H') {
                result.innerHTML = '<div class="success-message">CORRECT! "HELP" - her final desperate cry for assistance! <span class="puzzle-piece">U</span></div>';
                if (!solvedPuzzles.includes(8)) {
                    solvedPuzzles.push(8);
                    collectedLetters.push('U');
                    unlockNextPuzzle(8);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle9() {
            const answer = document.getElementById('puzzle9-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle9-result');
            
            if (answer === 'B') {
                result.innerHTML = '<div class="success-message">CORRECT! Two hearts, two souls broken... <span class="puzzle-piece">E</span></div>';
                if (!solvedPuzzles.includes(9)) {
                    solvedPuzzles.push(9);
                    collectedLetters.push('E');
                    unlockNextPuzzle(9);
                }
            } else {
              result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle10() {
            const answer = document.getElementById('puzzle10-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle10-result');
            
            if (answer === 'B') {
                result.innerHTML = '<div class="success-message">CORRECT! "DEATH" has 2 vowels (E, A), and B is the 2nd letter! <span class="puzzle-piece">B</span></div>';
                if (!solvedPuzzles.includes(10)) {
                    solvedPuzzles.push(10);
                    collectedLetters.push('B');
                    unlockNextPuzzle(10);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle11() {
            const answer = document.getElementById('puzzle11-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle11-result');
            
            if (answer === 'B') {
                result.innerHTML = '<div class="success-message">CORRECT! Reverse alphabet position 25 is B... <span class="puzzle-piece">O</span></div>';
                if (!solvedPuzzles.includes(11)) {
                    solvedPuzzles.push(11);
                    collectedLetters.push('O');
                    unlockNextPuzzle(11);
                }
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        function checkPuzzle12() {
            const answer = document.getElementById('puzzle12-input').value.toUpperCase().trim();
            const result = document.getElementById('puzzle12-result');
            
            if (answer === 'YOU ARE MINE' || answer === 'YOUAREMINE') {
                result.innerHTML = '<div class="success-message">CORRECT! "YOU ARE MINE" - her final, chilling declaration of eternal possession... <span class="puzzle-piece">Y</span></div>';
                if (!solvedPuzzles.includes(12)) {
                    solvedPuzzles.push(12);
                    collectedLetters.push('Y');
                    unlockNextPuzzle(12);
                }
            } else if (answer.includes('YOU') || answer.includes('ARE') || answer.includes('MINE')) {
                result.innerHTML = '<div class="error-message">You\'re getting close! Decode all the coordinates: 55=Y, 35=O, 51=U, 11=A, 42=R, 15=E, 33=M, 24=I, 34=N, 15=E</div>';
            } else {
                result.innerHTML = '<div class="error-message">WRONG! Try again.</div>';
            }
        }
        
        let draggedElement = null;
        let placedLetters = {};
        
        function displayCollectedLetters() {
            const container = document.getElementById('collected-pieces');
            container.innerHTML = '';
            collectedLetters.forEach((letter, index) => {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.textContent = letter;
                piece.draggable = true;
                piece.dataset.letter = letter;
                piece.dataset.index = index;
                
                piece.addEventListener('dragstart', handleDragStart);
                piece.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(piece);
            });
            
            const slots = document.querySelectorAll('.letter-slot');
            slots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
                slot.addEventListener('dragenter', handleDragEnter);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('click', handleSlotClick);
            });
        }
        
        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }
        
        function handleDragOver(e) {
            e.preventDefault();
        }
        
        function handleDragEnter(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedElement && !e.target.classList.contains('filled')) {
                const letter = draggedElement.dataset.letter;
                const position = e.target.dataset.position;
                
                e.target.textContent = letter;
                e.target.classList.add('filled');
                e.target.dataset.placedLetter = letter;
                
                draggedElement.remove();
                
                placedLetters[position] = letter;
                
                checkFinalCompletion();
            }
        }
        
        function handleSlotClick(e) {
            if (e.target.classList.contains('filled')) {
                const letter = e.target.dataset.placedLetter;
                const position = e.target.dataset.position;
                
                e.target.textContent = '';
                e.target.classList.remove('filled');
                delete e.target.dataset.placedLetter;
                delete placedLetters[position];
                
                const container = document.getElementById('collected-pieces');
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.textContent = letter;
                piece.draggable = true;
                piece.dataset.letter = letter;
                
                piece.addEventListener('dragstart', handleDragStart);
                piece.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(piece);
            }
        }
        
        function checkFinalCompletion() {
            const slots = document.querySelectorAll('.letter-slot');
            let allFilled = true;
            let correctMessage = true;
            
            slots.forEach(slot => {
                if (!slot.classList.contains('filled')) {
                    allFilled = false;
                } else {
                    const expectedLetter = slot.dataset.target;
                    const placedLetter = slot.dataset.placedLetter;
                    if (expectedLetter !== placedLetter) {
                        correctMessage = false;
                    }
                }
            });
            
            if (allFilled && correctMessage) {
                setTimeout(() => {
                    document.getElementById('final-modal').classList.add('show');
                }, 500);
            } else if (allFilled && !correctMessage) {
                const result = document.getElementById('final-result');
                result.innerHTML = '<div class="error-message">NOT QUITE RIGHT! REARRANGE TO SPELL "I LOVE YOU BABY"</div>';
            }
        }
        
        function closeFinalModal() {
            document.getElementById('final-modal').classList.remove('show');
            showPage('splash');
            
            // Reset game
            currentChapter = 1;
            solvedPuzzles = [];
            collectedLetters = [];
            placedLetters = {};
            
            // Reset timer
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            timeRemaining = 7200;
            const timerElement = document.getElementById('countdown-timer');
            if (timerElement) {
                timerElement.textContent = '02:00:00';
                timerElement.classList.remove('timer-warning');
            }
            
            // Reset puzzle buttons
            for (let i = 2; i <= 12; i++) {
                document.getElementById('puzzle' + i + '-btn').classList.add('locked');
                document.getElementById('puzzle' + i + '-btn').classList.remove('completed');
            }
            document.getElementById('puzzle1-btn').classList.remove('completed');
            
            // Clear inputs and results
            for (let i = 1; i <= 12; i++) {
                const input = document.getElementById('puzzle' + i + '-input');
                const result = document.getElementById('puzzle' + i + '-result');
                if (input) input.value = '';
                if (result) result.innerHTML = '';
            }
            
            // Reset letter slots
            const slots = document.querySelectorAll('.letter-slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.classList.remove('filled');
                delete slot.dataset.placedLetter;
            });
            
            document.getElementById('final-result').innerHTML = '';
            
            // Reset story navigation
            for (let i = 2; i <= 4; i++) {
                document.getElementById('chapter' + i).style.display = 'none';
            }
            document.getElementById('chapter1').style.display = 'block';
            document.getElementById('nextChapter').style.display = 'inline-block';
            document.getElementById('toPuzzles').style.display = 'none';
            document.getElementById('prevChapter').style.display = 'none';
        }
        
        // Create floating hearts animation
        function createFloatingHeart() {
            const heartsContainer = document.getElementById('floating-hearts');
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            
            // More spread out horizontal positions to avoid clustering
            const leftPosition = Math.random() * 120 - 10; // -10% to 110% for wider spread
            heart.style.left = leftPosition + '%';
            
            // Larger random starting position variation to spread hearts out more
            const startVariation = Math.random() * 400 - 200; // -200 to 200px variation
            heart.style.transform = `translateY(calc(100vh + 100px)) translateX(${startVariation}px)`;
            
            // Assign different animation types for variety
            const animationType = Math.floor(Math.random() * 3) + 1;
            const duration = 15 + Math.random() * 20; // 15-35 seconds for even more variation
            
            heart.style.animation = `floatUp${animationType} ${duration}s ease-in-out`;
            heart.style.animationDelay = Math.random() * 8 + 's'; // Longer delay spread
            
            // Random scale for size variety
            const scale = 0.6 + Math.random() * 0.8; // 0.6 to 1.4 scale for more variety
            heart.style.transform += ` scale(${scale})`;
            
            // Add unique z-index to prevent stacking issues
            heart.style.zIndex = Math.floor(Math.random() * 10) - 15; // -15 to -5
            
            heartsContainer.appendChild(heart);
            
            // Remove heart after animation completes
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, (duration + 8) * 1000);
        }
        
        // Initialize floating hearts
        function initFloatingHearts() {
            // Create more initial hearts with varied delays
            for (let i = 0; i < 25; i++) {
                setTimeout(() => createFloatingHeart(), Math.random() * 10000);
            }
            
            // Continue creating hearts at regular intervals
            function scheduleNextHeart() {
                const delay = 800 + Math.random() * 1200; // 0.8-2 second intervals
                setTimeout(() => {
                    createFloatingHeart();
                    scheduleNextHeart();
                }, delay);
            }
            
            scheduleNextHeart();
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            for (let i = 2; i <= 4; i++) {
                document.getElementById('chapter' + i).style.display = 'none';
            }
            
            // Start floating hearts animation
            initFloatingHearts();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a7bdf7234bfec0',t:'MTc1NDQxMjA4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>